<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Another password game...</title>
  <link rel="stylesheet" href="stylesheetV1.css" />
</head>

<!-- ‚òÄÔ∏è Dark Mode Toggle Button -->
<button id="darkModeToggle" class="dark-toggle">‚òÄÔ∏è</button>

<link id="themeStylesheet" rel="stylesheet" href="stylesheetV2.css" />

<body>

<!-- üèÜ Best Guess Section -->
<div id="bestGuess" class="best-guess">
    Best Guess: <span id="bestGuessText">None</span>
</div>
  
  <!-- üß† History Toggle Button -->
  <button id="toggleHistoryBtn" class="toggle-history">üß† Hint History</button>
  
  <!-- üóÉÔ∏è Slide-out History Panel -->
  <div id="historyPanel" class="history-panel">
    <h2>Hint History</h2>
    <div id="historyContent"></div>
  </div>
  

  <div class="game-container">
    <h1>Another password game...</h1>
    <input type="text" id="guessInput" placeholder="Enter your guess..." />    <button id="submitBtn">Guess</button>
    <p id="feedback"></p>
    <div id="hintContainer" class="hints"></div>
    <p class="attempts">Attempts: <span id="attemptCount">0</span></p>
  </div>

  <script>
    const correctPassword = "apple"; // CHANGE PASSWORD
    let attempts = 0;
  
    const input = document.getElementById("guessInput");
    const button = document.getElementById("submitBtn");
    const feedback = document.getElementById("feedback");
    const attemptDisplay = document.getElementById("attemptCount");
    const hintContainer = document.getElementById("hintContainer");
  
    function contains(str, pattern) {
      return pattern.test(str);
    }
  
    function getHintHTML(label, status) {
      if (status === "match") {
        return `<p>‚úÖ ${label}</p>`;
      } else if (status === "mismatch") {
        return `<p>‚ùå ${label}</p>`;
      } else {
        return `<p>No ${label.toLowerCase()}!</p>`;
      }
    }
  
    function generateHints(password, guess) {
    const hints = [];

    const has = {
        spaceP: password.includes(" "),
        spaceG: guess.includes(" "),
        capsP: /[A-Z]/.test(password),
        capsG: /[A-Z]/.test(guess),
        lettersP: /[a-zA-Z]/.test(password),
        lettersG: /[a-zA-Z]/.test(guess),
        punctP: /[()[\]{}"':;.,?!&~`_-]/.test(password),
        punctG: /[()[\]{}"':;.,?!&~`_-]/.test(guess),
        numsP: /\d/.test(password),
        numsG: /\d/.test(guess),
        specialP: /[@#$%^*=+|\\\/><]/.test(password),
        specialG: /[@#$%^*=+|\\\/><]/.test(guess),
    };

    // if password contains it but guess doesn't->   X (missing component)
    //if guess contains it but passoword doesnt ->   No (component)!
    // if both don't contain it                 ->   show nothing
    // if password and guess contain it         ->   check (component)

    // Space hint
    if (has.spaceP) {
        hints.push(getHintHTML("Space", has.spaceG ? "match" : "mismatch"));
    } else if (has.spaceG) {
        hints.push(getHintHTML("Space", "none"));
    }

    // Caps hint
    if (has.capsP) {
        hints.push(getHintHTML("Caps", has.capsG ? "match" : "mismatch"));
    } else if (has.capsG) {
        hints.push(getHintHTML("Caps", "none"));
    }

    // Letters hint
    if (has.lettersP) {
        hints.push(getHintHTML("Letters", has.lettersG ? "match" : "mismatch"));
    } else if (has.lettersG) {
        hints.push(getHintHTML("Letters", "none"));
    }

    // Punctuation hint
    if (has.punctP) {
        hints.push(getHintHTML("Punctuation characters", has.punctG ? "match" : "mismatch"));
    } else if (has.punctG) {
        hints.push(getHintHTML("Punctuation characters", "none"));
    }

    // Numbers hint
    if (has.numsP) {
        hints.push(getHintHTML("Numbers", has.numsG ? "match" : "mismatch"));
    } else if (has.numsG) {
        hints.push(getHintHTML("Numbers", "none"));
    }

    // Special characters hint
    if (has.specialP) {
        hints.push(getHintHTML("Special characters", has.specialG ? "match" : "mismatch"));
    } else if (has.specialG) {
        hints.push(getHintHTML("Special characters", "none"));
    }

    return hints;
    }

  
    button.addEventListener("click", () => {
    const guess = input.value.trim();
    attempts++;
    attemptDisplay.textContent = attempts;

    const guessLength = guess.length;
    const passwordLength = correctPassword.length;
    const lengthDifference = Math.abs(guessLength - passwordLength);

    hintContainer.innerHTML = "";

    if (guess === correctPassword) {
        feedback.textContent = "‚úÖ Correct! You guessed the password!";
        feedback.className = "success";
        input.disabled = true;
        button.disabled = true;
    } else {
        if (guessLength < passwordLength) {
        feedback.className = "warning";
        feedback.textContent = attempts >= 5
            ? `üîí Too short by ${lengthDifference}`
            : `üîí Too short!`;
        } else if (guessLength > passwordLength) {
        feedback.className = "warning";
        feedback.textContent = attempts >= 5
            ? `üîí Too long by ${lengthDifference}`
            : `üîí Too long!`;
        } else {
        feedback.className = "progress";
        feedback.textContent = "‚úîÔ∏è Right length!";
        }

        // Show hints after 3 attempts
        if (attempts >= 1) {
        const batchHints = generateHints(correctPassword, guess);
        hintContainer.innerHTML = batchHints.join("");

        const score = calculateGuessScore(correctPassword, guess, batchHints, lengthDifference);
        addToHistory(attempts, guess, batchHints, score);

        if (score > bestScore) {
            bestScore = score;
            bestGuess = guess;
            bestGuessText.textContent = `${guess} |Score: ${score}|`;
        }
        }
    }

    input.value = "";
    });


    // Allow pressing Enter to submit the guess
    input.addEventListener("keypress", (event) => {
    if (event.key === "Enter") {
        button.click(); // Triggers the same logic as clicking the Guess button
    }
    });


    // Best Guess tracking
    let bestScore = -Infinity;
    let bestGuess = "";
    const bestGuessText = document.getElementById("bestGuessText");
    const historyPanel = document.getElementById("historyPanel");
    const historyContent = document.getElementById("historyContent");
    const toggleHistoryBtn = document.getElementById("toggleHistoryBtn");

    function calculateGuessScore(password, guess, hints, lengthDiff) {
    let score = 0;

    // Base scoring from hints
    for (let hint of hints) {
        if (hint.includes("‚úÖ")) score += 1;
        else if (hint.includes("‚ùå") || hint.includes("No ")) score -= 1;
    }

    // Length penalty
    score -= lengthDiff;

    // Position match bonus
    const minLength = Math.min(password.length, guess.length);
    for (let i = 0; i < minLength; i++) {
        if (password[i] === guess[i]) {
        score += 1;
        }
    }

    return score;
    }


    function addToHistory(attemptNum, guess, hints, score) {
    const entry = document.createElement("div");
    entry.classList.add("history-entry");

    const passwordArr = correctPassword.split('');
    const guessArr = guess.split('');
    const matched = Array(passwordArr.length).fill(false);
    const formatted = [];

    // First pass: green for exact matches
    for (let i = 0; i < guessArr.length; i++) {
        if (passwordArr[i] === guessArr[i]) {
        formatted[i] = `<span class="char-match">${guessArr[i]}</span>`;
        matched[i] = true;
        } else {
        formatted[i] = null; // to be filled in second pass
        }
    }

    // Second pass: yellow (wrong position), red (not present)
    for (let i = 0; i < guessArr.length; i++) {
        if (formatted[i] !== null) continue;

        const letter = guessArr[i];
        let found = false;

        for (let j = 0; j < passwordArr.length; j++) {
        if (!matched[j] && passwordArr[j] === letter) {
            matched[j] = true;
            found = true;
            break;
        }
        }

        const colorClass = found ? "char-close" : "char-wrong";
        formatted[i] = `<span class="${colorClass}">${letter}</span>`;
    }

    entry.innerHTML = `
        <p><strong>Attempt #${attemptNum}</strong></p>
        <hr />
        <p>Guess: <code>${formatted.join("")}</code></p>
        <p>Score: ${score}</p>
        <p>Hints:</p>
        ${hints.map(h => `<p>${h.replaceAll('<p>', '').replaceAll('</p>', '')}</p>`).join("")}
    `;

    historyContent.prepend(entry);
    }




    toggleHistoryBtn.addEventListener("click", () => {
    historyPanel.classList.toggle("open");
    });

    // Allow clicking the history panel itself to close it
    document.querySelector("#historyPanel h2").addEventListener("click", () => {
    historyPanel.classList.remove("open");
    });


    // Persistent Dark Mode Toggle
    const themeLink = document.getElementById("themeStylesheet");
    const darkModeToggle = document.getElementById("darkModeToggle");

    // Check saved preference
    let darkMode = localStorage.getItem("darkMode") === "true";

    // Apply on page load
    applyTheme();

    darkModeToggle.addEventListener("click", () => {
    darkMode = !darkMode;
    localStorage.setItem("darkMode", darkMode);
    applyTheme();
    });

    function applyTheme() {
    themeLink.setAttribute("href", darkMode ? "styling_dark.css" : "styling.css");
    darkModeToggle.textContent = darkMode ? "üåû" : "‚òÄÔ∏è";
    };


  </script>
  
  